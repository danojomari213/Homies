"use strict";const urlParams=new URLSearchParams(window.location.search);let urlParamsObj={searchQuery:$.trim(urlParams.get("searchQuery")).replace(/\s\s+/g," "),datePosted:urlParams.get("datePosted"),jobCategory:urlParams.get("jobCategory"),employmentType:urlParams.get("employmentType"),page:urlParams.get("page")};history.replaceState(null,null,getURLQueryString(urlParamsObj));const backToCareers=()=>location.assign("/careers"),setSearchFormValues=()=>{resetForm("#searchJobForm"),$("#datePosted").val(null).trigger("change"),$("#jobCategory").val(null).trigger("change"),$("#employmentType").val(null).trigger("change"),isEmptyOrNull(urlParamsObj.searchQuery)||setValue("#searchQuery",urlParamsObj.searchQuery),isEmptyOrNull(urlParamsObj.datePosted)||(setValue("#datePosted",urlParamsObj.datePosted),$("#datePosted").val(urlParamsObj.datePosted).trigger("change")),isEmptyOrNull(urlParamsObj.jobCategory)||(setValue("#jobCategory",urlParamsObj.jobCategory),$("#jobCategory").val(urlParamsObj.jobCategory).trigger("change")),isEmptyOrNull(urlParamsObj.employmentType)||(setValue("#employmentType",urlParamsObj.employmentType),$("#employmentType").val(urlParamsObj.employmentType).trigger("change"))},redirectWithURLParams=()=>{const e=getURLQueryString(urlParamsObj);isEmptyOrNull(e)?location.assign("/careers"):location.assign("/careers"+e)};ifSelectorExist("#searchJobForm",()=>{GET_ajax(`${BASE_PUBLIC_API}careers/job-categories`,{success:e=>{let a=$("#jobCategory");a.empty().append("<option></option>"),e.length>0?e.forEach(e=>a.append(`<option value="${e.job_category_id}">${e.name}</option>`)):a.append("<option disabled>No data</option>"),$("#jobCategory").select2({placeholder:"Job Category"}),$("#jobCategory").val(urlParamsObj.jobCategory).trigger("change")},error:()=>toastr.error("There was an error in getting job categories")}),GET_ajax(`${BASE_PUBLIC_API}careers/employment-types`,{success:e=>{let a=$("#employmentType");a.empty().append("<option></option>"),e.length>0?e.forEach(e=>a.append(`<option value="${e.employment_type_id}">${e.name}</option>`)):a.append("<option disabled>No data</option>"),a.select2({placeholder:"Employment Type"}).val(urlParamsObj.employmentType).trigger("change")}}),$("#searchJobForm_Loader").remove(),showElement("#searchJobForm");const e=[{label:"Last 7 days",value:moment().subtract(7,"days").format("YYYY-MM-DD")},{label:"Last 14 days",value:moment().subtract(14,"days").format("YYYY-MM-DD")},{label:"Last month",value:moment().subtract(1,"months").format("YYYY-MM-DD")},{label:"Last 2 months",value:moment().subtract(2,"months").format("YYYY-MM-DD")},{label:"Last 6 months",value:moment().subtract(6,"months").format("YYYY-MM-DD")},{label:"Last year",value:moment().subtract(1,"years").format("YYYY-MM-DD")}];let a=$("#datePosted");a.empty().append("<option></option>"),e.length>0?e.forEach(e=>a.append(`<option value="${e.value}">${e.label}</option>`)):a.append("<option disabled>No data yet</option>"),a.select2({placeholder:"Date Posted"}).val(urlParamsObj.datePosted).trigger("change")}),ifSelectorExist("#availableJobList",()=>{resetForm("#searchJobForm"),$("#datePosted").val(null).trigger("change"),$("#jobCategory").val(null).trigger("change"),$("#employmentType").val(null).trigger("change"),isEmptyOrNull(urlParamsObj.searchQuery)||setValue("#searchQuery",urlParamsObj.searchQuery),isEmptyOrNull(urlParamsObj.datePosted)||(setValue("#datePosted",urlParamsObj.datePosted),$("#datePosted").val(urlParamsObj.datePosted).trigger("change")),isEmptyOrNull(urlParamsObj.jobCategory)||(setValue("#jobCategory",urlParamsObj.jobCategory),$("#jobCategory").val(urlParamsObj.jobCategory).trigger("change")),isEmptyOrNull(urlParamsObj.employmentType)||(setValue("#employmentType",urlParamsObj.employmentType),$("#employmentType").val(urlParamsObj.employmentType).trigger("change"));const e=getURLQueryString(urlParamsObj);$.ajax({url:`${BASE_PUBLIC_API}careers/job-posts${e}`,type:"GET",success:e=>{let a="";e.length>0?(()=>e.forEach(e=>{const t=e.manpower_request,r=e.is_salary_visible?`<div>\n                            <i style="width: 1.25rem" class="fas fa-handshake text-center text-secondary mr-1"></i>\n                            <span>${formatCurrency(t.min_monthly_salary)} - ${formatCurrency(t.max_monthly_salary)}</span>\n                        </div>`:"",s=isEmptyOrNull(e.expiration_date)?'<div>\n                            <i style="width: 1.25rem" class="fas fa-clock text-center text-secondary mr-1"></i>\n                            <span>Still open for all applicants</span>\n                        </div>':`<div>\n                            <i style="width: 1.25rem" class="fas fa-clock text-center text-danger mr-1"></i>\n                            <span>Open until ${formatDateTime(e.expiration_date,"Date")}</span>\n                        </div>`;a+=`\n                    <div class="col-12 col-md-6 d-flex align-items-stretch flex-column">\n                        <div class="card d-flex flex-fill">\n                            <div class="card-body">\n\n                                <div>\n                                    <div class="mb-3">\n                                        <a href="${ORIGIN}careers/${e.job_post_id}" class="h5 text-primary mb-0 font-weight-bold">${t.vacant_position.name}</a>\n                                        <div class="d-flex justify-content-between align-items-center">\n                                            <div class="small text-muted">\n                                                <span>Posted ${formatDateTime(e.created_at,"Date")}</span>\n                                                <span class="mx-1">&middot;</span>\n                                                <span>${fromNow(e.created_at)}</span>\n                                            </div>\n                                            <div class="small text-muted">\n                                                <i class="fas fa-eye mr-1"></i>\n                                                <span>${e.views}</span>\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <div class="mb-3">\n                                        ${(()=>{const a=e.job_category;return`\n                        <div>\n                            <i style="width: 1.25rem" class="fas fa-th-list text-center text-secondary mr-1"></i>\n                            <span>${a.is_removed?"Others":a.name}</span>\n                        </div>\n                    `})()}\n                                        <div>\n                                            <i style="width: 1.25rem" class="fas fa-briefcase text-center text-secondary mr-1"></i>\n                                            <span>${t.employment_type.name}</span>\n                                        </div>\n                                        ${r}\n                                        ${s}\n                                        <div class="pt-3 career-content-preview">\n                                            ${e.content}\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                            </div>\n                            <div class="card-footer text-right">\n                                <a href="${ORIGIN}careers/${e.job_post_id}" class="btn btn-sm btn-primary">\n                                    ${TEMPLATE.LABEL_ICON("View More","caret-right")}\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                `}))():a=`\n                    <div class="col-12">\n                        <div class="d-flex flex-column justify-content-center align-items-center text-center">\n                            <div class="py-5 d-flex justify-content-center">\n                                <img \n                                    draggable="false"\n                                    src="${ORIGIN}static/dist/img/careers_full.svg" \n                                    alt="Not found" \n                                    width="25%"\n                                >\n                            </div>\n                            <h4>Oops! There is no result!</h4>\n                            <p class="text-secondary">We find nothing based on your request. Please try other keywords.</p>\n                        </div>\n                    </div>\n                `,setContent("#availableJobList",a)},error:()=>toastr.error("There was an error in getting all job posts")}),$.ajax({url:`${BASE_PUBLIC_API}careers/job-posts/analytics${e}`,type:"GET",success:e=>{const a=e.total,t=urlParamsObj.page?urlParamsObj.page:1,r=Math.ceil(a/FETCH_ROWS);isEmptyOrNull(urlParamsObj.searchQuery)?$("#searchLabel").remove():a>0&&t<=r?setContent("#searchLabel",`Search result for <b>"${urlParamsObj.searchQuery}"</b>`):setContent("#searchLabel",`The search <b>"${urlParamsObj.searchQuery}"</b> did not found any result`),a>0&&t<=r?(setContent({"#pageDisplay":`Showing page ${t} out of ${r}`,"#totalResultDisplay":`${a} ${pluralize("result",a)} are found`}),setPagination("#pagination",{totalRows:a,currentPage:t}),showElement("#pagination")):setContent({"#pageDisplay":"No page was displayed","#totalResultDisplay":"0 results were found"})}})}),ifSelectorExist("#availableJobDetails",()=>{const e=getPathnamePart(1);$.ajax({url:`${BASE_PUBLIC_API}careers/job-posts/${e}`,type:"GET",success:e=>{const a=e.manpower_request;setValue("#jobPostID",e.job_post_id);const t=e.created_at;if(setContent({"#vacantPosition":a.vacant_position.name,"#datePosted":`Posted ${formatDateTime(t,"Date")}`,"#jobPostViews":()=>{const a=e.views;return`This post was visited ${a} ${pluralize("time",a)}`},"#datePostedHumanized":fromNow(t),"#jobDescription":e.content,"#employmentType":a.employment_type.name,"#jobCategory":e.job_category.name}),e.is_salary_visible){const e=a.min_monthly_salary,t=a.max_monthly_salary;setContent("#salaryRange",`\n                    <div>Range: ${formatCurrency(e)} - ${formatCurrency(t)}</div>\n                    <div>Average: ${formatCurrency((e+t)/2)}</div>\n                `)}else hideElement("#salaryRangeDisplay");setContent("#openUntil",()=>{const a=e.expiration_date;return isEmptyOrNull(a)?TEMPLATE.UNSET("No deadline"):`\n                        <div>${formatDateTime(a,"Date")}</div>\n                        ${TEMPLATE.SUBTEXT(fromNow(a))}\n                    `}),isBeforeToday(e.expiration_date)?($("#applicationForm").remove(),$("#applyNowRedirect").remove(),showElement("#applicationsNotAvailable")):$("#applicationsNotAvailable").remove(),$("#vacantPositionLoader").remove(),$("#availableJobDetailsLoader").remove(),showElement("#vacantPositionContainer"),showElement("#availableJobDetails")},error:()=>toastr.error("There was an error in getting job details")});const a=()=>{PUT_ajax(`${BASE_PUBLIC_API}careers/job-posts/${e}/increment-views`,null,{success:e=>{setContent("#jobPostViews",`This post was visited ${e} ${pluralize("time",e)}`)},error:()=>toastr.error("There was an error in updating page views")})};let t=JSON.parse(sessionStorage.getItem("visited_job_posts"));if(t){t.includes(e)||(t.push(e),sessionStorage.setItem("visited_job_posts",JSON.stringify(t)),a())}else sessionStorage.setItem("visited_job_posts",JSON.stringify([e])),a()}),validateForm("#applicationForm",{rules:{jobPostID:{required:!0},firstName:{required:!0},lastName:{required:!0},contactNumber:{required:!0},email:{required:!0,email:!0},resume:{required:!0,accept:"application/pdf"}},messages:{jobPostID:{required:"This must have a value"},firstName:{required:"Your first name is required"},lastName:{required:"Your last name is required"},contactNumber:{required:"Your contact number is required"},email:{required:"Your email is required",email:"This must be a valid email"},resume:{required:"Your resume is required to upload",accept:"Please upload your resume in PDF type"}},submitHandler:()=>{const e=generateFormData("#applicationForm");return setContent({"#applicantFullName":formatName("F M. L, S",{firstName:e.get("firstName"),middleName:e.get("middleName"),lastName:e.get("lastName"),suffixName:e.get("suffixName")}),"#applicantContactNumber":e.get("contactNumber"),"#applicantEmail":e.get("email"),"#submitApplicationMode":!0}),$("#confirmApplicationModal").modal("show"),!1}}),onHideModal("#confirmApplicationModal",()=>{uncheckElement("#confirmReview"),disableElement("#submitApplicationBtn"),setContent({"#applicantFullName":"","#applicantContactNumber":"","#applicantEmail":"","#submitApplicationMode":!1})}),onChange("#confirmReview",()=>isChecked("#confirmReview")?enableElement("#submitApplicationBtn"):disableElement("#submitApplicationBtn")),onClick("#submitApplicationBtn",()=>{btnToLoadingState("#submitApplicationBtn"),disableElement("#cancelApplicationBtn"),disableElement("#confirmReview");const e=generateFormData("#applicationForm"),a=a=>e.get(a),t=$("#resume")[0].files[0],r=new FormData;r.append("file",t);const s=()=>{hideModal("#confirmApplicationModal"),setContent("#submitApplicationBtn",TEMPLATE.LABEL_ICON("Submit","file-export")),enableElement("#cancelApplicationBtn"),enableElement("#confirmReview"),uncheckElement("#confirmReview")};$.ajax({url:`${BASE_PUBLIC_API}careers/upload/resume`,type:"POST",processData:!1,contentType:!1,data:r,success:e=>{const t={job_post_id:a("jobPostID"),first_name:a("firstName"),middle_name:a("middleName"),last_name:a("lastName"),suffix_name:a("suffixName"),contact_number:a("contactNumber"),email:a("email"),resume:e.new_file};$.ajax({url:`${BASE_PUBLIC_API}careers/apply`,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:e=>{e&&(hideModal("#confirmApplicationModal"),setContent("#submitApplicationBtn",TEMPLATE.LABEL_ICON("Submit","file-export")),enableElement("#cancelApplicationBtn"),enableElement("#confirmReview"),resetForm("#applicationForm"),uncheckElement("#confirmReview"),toastr.success("Your application is successfully submitted. Please check your email."))},error:()=>{s(),toastr.error("There was a problem in submitting your application")}})},error:()=>{s(),toastr.error("There was a problem in uploading your resume")}})}),validateForm("#searchJobForm",{submitHandler:()=>{const e=generateFormData("#searchJobForm").get("searchQuery");return isEmptyOrNull(e)||(setContent("#availableJobList",'\n                <div class="col-12">\n                    <div class="text-center my-5 py-5 wait">\n                        <div class="spinner-border text-primary mb-2" style="width: 2.5rem; height: 2.5rem"></div>\n                        <div>Please wait while loading the list ...</div>\n                    </div>\n                </div>\n            '),hideElement("#pagination")),urlParamsObj.searchQuery=$.trim(e).replace(/\s\s+/g," "),urlParamsObj.page=null,redirectWithURLParams(),!1}}),$("#datePosted").on("select2:select",()=>{urlParamsObj.searchQuery=$("#searchQuery").val(),urlParamsObj.datePosted=$("#datePosted").val(),urlParamsObj.page=null,redirectWithURLParams()}),$("#jobCategory").on("select2:select",()=>{urlParamsObj.searchQuery=$("#searchQuery").val(),urlParamsObj.jobCategory=$("#jobCategory").val(),urlParamsObj.page=null,redirectWithURLParams()}),$("#employmentType").on("select2:select",()=>{urlParamsObj.searchQuery=$("#searchQuery").val(),urlParamsObj.employmentType=$("#employmentType").val(),urlParamsObj.page=null,redirectWithURLParams()}),$("#datePosted, #jobCategory, #employmentType").on("select2:select",()=>{setContent("#availableJobList",'\n        <div class="col-12">\n            <div class="text-center my-5 py-5 wait">\n                <div class="spinner-border text-primary mb-2" style="width: 2.5rem; height: 2.5rem"></div>\n                <div>Please wait while loading the list ...</div>\n            </div>\n        </div>\n    '),hideElement("#pagination")}),$("#resetFilters").on("click",()=>{isEmptyOrNull(urlParamsObj.datePosted)&&isEmptyOrNull(urlParamsObj.jobCategory)&&isEmptyOrNull(urlParamsObj.employmentType)||(urlParamsObj.datePosted=null,urlParamsObj.jobCategory=null,urlParamsObj.employmentType=null,urlParamsObj.page=null,$("#datePosted").val("").trigger("change"),$("#jobCategory").val("").trigger("change"),$("#employmentType").val("").trigger("change"),setContent("#availableJobList",'\n            <div class="col-12">\n                <div class="text-center my-5 py-5 wait">\n                    <div class="spinner-border text-primary mb-2" style="width: 2.5rem; height: 2.5rem"></div>\n                    <div>Please wait while loading the list ...</div>\n                </div>\n            </div>\n        '),hideElement("#pagination"),redirectWithURLParams())});